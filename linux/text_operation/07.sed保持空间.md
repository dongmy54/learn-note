#### sed 保持空间

> 通过保持空间临时存放数据来达到某些目的

##### 基础

```text
文本文件   ｜       模式空间          ｜ 保持空间
          |   每次从sed读取1行       ｜  在刚开始的时候，保持空间内容是空的（\n)
          |   输出的内容都是模式空间的 ｜ 用于暂时储存数据
               
---------------------------------------------------------
命令             
                h/H 模式空间内容 -->  保持空间（PS：小写h代表覆盖，大写H代表追加）
                g/G 模式空间    <-- 保持空间内容（PS：小写覆盖、大写覆盖）
                x   模式空间    <-->(交换) 保持空间
               
```

##### 用法

```bash
# 测试文件
cat lines.txt
#1
#2
#3
#4
#5

# 目标：将lines.txt的内容倒叙展示
# 1h   将第一行 放到保持空间
# 1!G  除第一行外，需要将保持空间内容追加到模式空间
# $!x  除最后一行，不需要交换模式空间 和 保持空间
# $p   打印最后一行处理结果
sed -n '1h;1!G;$!x;$p' lines.txt
#5
#4
#3
#2
#1
```

##### 原理

> 我们可用通过 `sed -n '1h;G;x;1p' lines.txt` 每次打印一行的方式来查看处理过程

```text
分析各行处理过程

第一行 sed -n '1h;G;x;1p' lines.txt
-------------------------------------------------------------------
          模式空间     保持空间            说明
初始          1        \n(没有内容)

1h           1           1               将模式空间1，放到保持空间后，保持空间有了1

G            1           1               将保持空间1,追加到模式空间，模式空间有了两个1
             1

x            1            1              交换模式空间 和 保持空间后，模式空间1，保持空间两个1
                          1
最终输出模式空间： 1


第二行 sed -n '1h;G;x;2p' lines.txt
-------------------------------------------------------------------
         模式空间     保持空间            说明
初始         2           1               此时第二行2读取进来，保持空间还是上一轮的两个1
                        1
                        
G           2           1               将保持空间追加到模式空间后，模式空间变成 2 1 1
            1           1
            1

x           1           2              两空间交换
            1           1
                        1
最终输出模式空间：1 1


第三行 sed -n '1h;G;x;3p' lines.txt
----------------------------------------------------------------------
         模式空间     保持空间            说明
初始         3           2               此时第三行3读取进来，保持空间还是上一轮的2 1 1
                        1
                        1
                        
G           3          2                 保持空间追加到模式空间变成 3 2 1 1
            2          1
            1          1
            1

x           2          3
            1          2
            1          1
                       1
最终输出模式空间：2 1 1

其它行依次类推（这样也就不难理解为啥第一行要1!G;最后一行要$!x)
```

